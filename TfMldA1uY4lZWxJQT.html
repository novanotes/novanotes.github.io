<html><head><base href="." />
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nova Text</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
:root {
  --bg: #0a0d14;
  --text: #e0e0e0;
  --accent: #7c4dff;
  --danger: #ff1744;
  --surface: #151a23;
}

body {
  margin: 0;
  padding: 20px;
  min-height: 100vh;
  font-family: system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
}

.container {
  max-width: 1000px;
  margin: 0 auto;
}

.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--bg);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.loader {
  width: 50px;
  height: 50px;
  border: 3px solid var(--surface);
  border-top: 3px solid var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.landing-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  text-align: center;
  padding: 20px;
}

.landing-title {
  font-size: 4em;
  margin-bottom: 20px;
  background: linear-gradient(45deg, var(--accent), #9d6eff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.landing-subtitle {
  font-size: 1.2em;
  margin-bottom: 40px;
  opacity: 0.8;
  max-width: 600px;
}

.get-started-btn {
  padding: 15px 40px;
  font-size: 1.2em;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 30px;
  cursor: pointer;
  transition: all 0.3s;
}

.get-started-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(124, 77, 255, 0.3);
}

.features-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 30px;
  max-width: 1000px;
  margin: 60px auto;
}

.feature-card {
  background: var(--surface);
  padding: 30px;
  border-radius: 15px;
  text-align: left;
}

.feature-card i {
  font-size: 2em;
  color: var(--accent);
  margin-bottom: 15px;
}

.home-container {
  display: none;
}

.toolbar {
  display: flex;
  gap: 15px;
  padding: 15px;
  background: var(--surface);
  border-radius: 10px;
  margin-bottom: 20px;
}

.tool-group {
  display: flex;
  gap: 5px;
  padding: 0 10px;
  border-right: 1px solid #2a2f3a;
}

.tool-group:last-child {
  border: none;
}

.tool-btn {
  padding: 8px;
  border: none;
  border-radius: 6px;
  background: transparent;
  color: var(--text);
  cursor: pointer;
  transition: all 0.2s;
}

.tool-btn:hover {
  background: rgba(124, 77, 255, 0.2);
  color: var(--accent);
}

.note-area {
  width: 100%;
  min-height: 500px;
  padding: 25px;
  margin: 20px 0;
  background: var(--surface);
  border: 1px solid #2a2f3a;
  border-radius: 10px;
  color: var(--text);
  font-size: 16px;
  line-height: 1.6;
  resize: vertical;
}

::selection {
  background: var(--accent);
  color: white;
}

.note-area {
  -webkit-tap-highlight-color: var(--accent);
  user-select: text;
}

.status {
  position: fixed;
  bottom: 20px;
  right: 20px;
  padding: 12px 20px;
  border-radius: 8px;
  opacity: 0;
  transition: all 0.3s;
  transform: translateY(20px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.status.show {
  opacity: 1;
  transform: translateY(0);
}

.success {
  background: #2e7d32;
  color: white;
}

.error {
  background: var(--danger);
  color: white;
}

.encryption-notice {
  margin-top: 20px;
  padding: 15px;
  background: var(--surface);
  border-radius: 10px;
  font-size: 14px;
  line-height: 1.4;
  display: flex;
  align-items: center;
  gap: 10px;
}

.pulse {
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

.word-count {
  position: fixed;
  bottom: 20px;
  left: 20px;
  padding: 8px 15px;
  background: var(--surface);
  border-radius: 20px;
  font-size: 14px;
  opacity: 0.7;
}

.projects-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
  margin: 20px 0;
}

.project-card {
  background: var(--surface);
  border-radius: 10px;
  padding: 20px;
  transition: all 0.2s;
  cursor: pointer;
  border: 1px solid #2a2f3a;
  position: relative;
}

.project-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  border-color: var(--accent);
}

.new-project {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 150px;
  border: 2px dashed #2a2f3a;
}

.new-project:hover {
  border: 2px dashed var(--accent);
}

.new-project i {
  font-size: 2em;
  margin-bottom: 10px;
}

.project-title {
  font-size: 1.2em;
  margin-bottom: 10px;
}

.project-date {
  font-size: 0.8em;
  opacity: 0.7;
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.8);
  justify-content: center;
  align-items: center;
  z-index: 1001;
}

.modal.show {
  display: flex;
}

.modal-content {
  background: var(--surface);
  padding: 30px;
  border-radius: 10px;
  width: 90%;
  max-width: 400px;
}

.modal input {
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  background: var(--bg);
  border: 1px solid #2a2f3a;
  border-radius: 5px;
  color: var(--text);
}

.modal-buttons {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

.modal-btn {
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.2s;
}

.primary-btn {
  background: var(--accent);
  color: white;
}

.secondary-btn {
  background: #2a2f3a;
  color: var(--text);
}

.editor-container {
  display: none;
}

@media (max-width: 768px) {
  body {
    padding: 10px;
  }
  
  .toolbar {
    flex-wrap: wrap;
  }
  
  .tool-group {
    padding: 5px;
  }
  
  .modal-content {
    width: 95%;
    padding: 20px;
  }
  
  .projects-grid {
    grid-template-columns: 1fr;
  }
}

.font-select {
  padding: 6px;
  border-radius: 4px;
  background: var(--bg);
  color: var(--text);
  border: 1px solid #2a2f3a;
  cursor: pointer;
}

.font-size-select {
  width: 60px;
  padding: 6px;
  border-radius: 4px;
  background: var(--bg);
  color: var(--text);
  border: 1px solid #2a2f3a;
  cursor: pointer;
}
</style>
</head>
<body>
<div class="loading-overlay">
  <div class="loader"></div>
</div>

<div class="container">
  <div class="landing-container">
    <h1 class="landing-title"><i class="fas fa-pen-fancy"></i> Nova Text</h1>
    <p class="landing-subtitle">A secure, private note-taking experience with real-time encryption and powerful editing features.</p>
    <button class="get-started-btn" onclick="showDashboard()">Get Started</button>
    
    <div class="features-grid">
      <div class="feature-card">
        <i class="fas fa-shield-alt"></i>
        <h3>Secure & Private</h3>
        <p>Your notes are automatically encrypted and only accessible from your IP address.</p>
      </div>
      <div class="feature-card">
        <i class="fas fa-sync"></i>
        <h3>Auto-Saving</h3>
        <p>Never lose your work with automatic saving every few seconds.</p>
      </div>
      <div class="feature-card">
        <i class="fas fa-edit"></i>
        <h3>Rich Text Editor</h3>
        <p>Format your text with professional editing tools and shortcuts.</p>
      </div>
    </div>
  </div>

  <div class="home-container">
    <h1><i class="fas fa-pen-fancy"></i> Nova Text</h1>
    <div class="projects-grid">
      <div class="project-card new-project" onclick="showNewProjectModal()">
        <i class="fas fa-plus"></i>
        <div>New Project</div>
      </div>
    </div>
  </div>

  <div class="editor-container">
    <div class="toolbar">
      <div class="tool-group">
        <select class="font-select" onchange="changeFont(this.value)">
          <option value="system-ui">Default</option>
          <option value="Arial">Arial</option>
          <option value="Times New Roman">Times New Roman</option>
          <option value="Courier New">Courier New</option>
          <option value="Georgia">Georgia</option>
          <option value="Verdana">Verdana</option>
        </select>
        <select class="font-size-select" onchange="changeFontSize(this.value)">
          <option value="1">8pt</option>
          <option value="2">10pt</option>
          <option value="3" selected>12pt</option>
          <option value="4">14pt</option>
          <option value="5">18pt</option>
          <option value="6">24pt</option>
          <option value="7">36pt</option>
        </select>
      </div>
      <div class="tool-group">
        <button class="tool-btn" onclick="formatText('bold')" title="Bold"><i class="fas fa-bold"></i></button>
        <button class="tool-btn" onclick="formatText('italic')" title="Italic"><i class="fas fa-italic"></i></button>
        <button class="tool-btn" onclick="formatText('underline')" title="Underline"><i class="fas fa-underline"></i></button>
      </div>
      <div class="tool-group">
        <button class="tool-btn" onclick="formatText('justifyLeft')" title="Align Left"><i class="fas fa-align-left"></i></button>
        <button class="tool-btn" onclick="formatText('justifyCenter')" title="Align Center"><i class="fas fa-align-center"></i></button>
        <button class="tool-btn" onclick="formatText('justifyRight')" title="Align Right"><i class="fas fa-align-right"></i></button>
      </div>
      <div class="tool-group">
        <button class="tool-btn" onclick="formatText('insertUnorderedList')" title="Bullet List"><i class="fas fa-list-ul"></i></button>
        <button class="tool-btn" onclick="formatText('insertOrderedList')" title="Numbered List"><i class="fas fa-list-ol"></i></button>
      </div>
      <div class="tool-group">
        <button class="tool-btn" onclick="clearNotes()" title="Clear"><i class="fas fa-trash"></i></button>
      </div>
      <div class="tool-group">
        <button class="tool-btn" onclick="formatText('strikeThrough')" title="Strikethrough"><i class="fas fa-strikethrough"></i></button>
        <button class="tool-btn" onclick="formatText('subscript')" title="Subscript"><i class="fas fa-subscript"></i></button>
        <button class="tool-btn" onclick="formatText('superscript')" title="Superscript"><i class="fas fa-superscript"></i></button>
      </div>
      <div class="tool-group">
        <button class="tool-btn" onclick="formatText('indent')" title="Indent"><i class="fas fa-indent"></i></button>
        <button class="tool-btn" onclick="formatText('outdent')" title="Outdent"><i class="fas fa-outdent"></i></button>
        <button class="tool-btn" onclick="insertHorizontalRule()" title="Horizontal Line"><i class="fas fa-minus"></i></button>
      </div>
      <div class="tool-group">
        <button class="tool-btn" onclick="formatText('undo')" title="Undo"><i class="fas fa-undo"></i></button>
        <button class="tool-btn" onclick="formatText('redo')" title="Redo"><i class="fas fa-redo"></i></button>
      </div>
    </div>

    <div class="note-area" contenteditable="true" spellcheck="false"></div>
    <div class="word-count">Words: 0</div>
    <div class="status"></div>
    <div class="encryption-notice">
      <i class="fas fa-shield-alt pulse"></i>
      Your notes are automatically encrypted and stored privately using your IP address as the unique identifier. 
      Notes are only accessible from your current IP address.
    </div>
  </div>
</div>

<div class="modal" id="newProjectModal">
  <div class="modal-content">
    <h2>Create New Project</h2>
    <input type="text" id="projectName" placeholder="Enter project name">
    <div class="modal-buttons">
      <button class="modal-btn secondary-btn" onclick="closeModal()">Cancel</button>
      <button class="modal-btn primary-btn" onclick="createProject()">Create</button>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script>
const noteArea = document.querySelector('.note-area');
const status = document.querySelector('.status');
const wordCount = document.querySelector('.word-count');
let encryptionKey = '';
let lastSave = '';

fetch('https://api.ipify.org?format=json')
  .then(response => response.json())
  .then(data => {
    encryptionKey = data.ip;
    loadProjects();
    document.querySelector('.loading-overlay').style.display = 'none';
  })
  .catch(err => {
    showStatus('Unable to initialize secure storage', 'error');
    document.querySelector('.loading-overlay').style.display = 'none';
  });

function encrypt(text) {
  return CryptoJS.AES.encrypt(text, encryptionKey).toString();
}

function decrypt(ciphertext) {
  try {
    const bytes = CryptoJS.AES.decrypt(ciphertext, encryptionKey);
    return bytes.toString(CryptoJS.enc.Utf8);
  } catch (e) {
    return '';
  }
}

function saveNotes() {
  const content = noteArea.innerHTML;
  if (content !== lastSave) {
    const currentProjectId = localStorage.getItem('currentProject');
    if (currentProjectId) {
      let projects = JSON.parse(localStorage.getItem('projects') || '[]');
      const projectIndex = projects.findIndex(p => p.id === parseInt(currentProjectId));
      if (projectIndex !== -1) {
        projects[projectIndex].content = content;
        localStorage.setItem('projects', JSON.stringify(projects));
        lastSave = content;
        showStatus('Autosaved', 'success');
      }
    }
  }
}

function loadProjects() {
  const projects = JSON.parse(localStorage.getItem('projects') || '[]');
  const projectsGrid = document.querySelector('.projects-grid');
  const newProjectCard = projectsGrid.firstElementChild;
  projectsGrid.innerHTML = '';
  projectsGrid.appendChild(newProjectCard);

  projects.forEach(project => {
    const card = document.createElement('div');
    card.className = 'project-card';
    card.innerHTML = `
      <div class="project-title">${project.name}</div>
      <div class="project-date">${new Date(project.created).toLocaleDateString()}</div>
    `;
    card.onclick = () => openProject(project.id);
    projectsGrid.appendChild(card);
  });
}

function openProject(projectId) {
  const projects = JSON.parse(localStorage.getItem('projects') || '[]');
  const project = projects.find(p => p.id === projectId);
  if (project) {
    document.querySelector('.landing-container').style.display = 'none';
    document.querySelector('.home-container').style.display = 'none';
    document.querySelector('.editor-container').style.display = 'block';
    noteArea.innerHTML = project.content;
    lastSave = project.content;
    localStorage.setItem('currentProject', projectId);
  }
}

function clearNotes() {
  if (confirm('Are you sure you want to clear all notes?')) {
    noteArea.innerHTML = '';
    showStatus('Notes cleared', 'success');
    updateWordCount();
  }
}

function formatText(command) {
  document.execCommand(command, false, null);
  noteArea.focus();
}

function showStatus(message, type) {
  status.textContent = message;
  status.className = `status show ${type}`;
  setTimeout(() => {
    status.className = 'status';
  }, 2000);
}

function updateWordCount() {
  const text = noteArea.innerText || '';
  const words = text.trim().split(/\s+/).filter(word => word.length > 0);
  wordCount.textContent = `Words: ${words.length}`;
}

// Autosave every 5 seconds if changes detected
setInterval(saveNotes, 5000);

// Save before closing/leaving page
window.addEventListener('beforeunload', saveNotes);
window.addEventListener('pagehide', saveNotes);

// Update word count on input
noteArea.addEventListener('input', updateWordCount);

// Initial focus
document.addEventListener('DOMContentLoaded', () => {
  noteArea.focus();
});

// Only update word count if we're in editor view
if (document.querySelector('.editor-container').style.display === 'block') {
  updateWordCount();
}

noteArea.addEventListener('touchstart', function(e) {
  if (e.touches.length === 1) {
    noteArea.focus();
  }
}, { passive: true });

noteArea.addEventListener('touchend', function(e) {
  const selection = window.getSelection();
  if (selection.toString().length === 0) {
    noteArea.focus();
  }
}, { passive: true });

function showNewProjectModal() {
  document.getElementById('newProjectModal').classList.add('show');
  document.getElementById('projectName').focus();
}

function closeModal() {
  document.getElementById('newProjectModal').classList.remove('show');
  document.getElementById('projectName').value = '';
}

function createProject() {
  const projectName = document.getElementById('projectName').value.trim();
  if (!projectName) {
    showStatus('Please enter a project name', 'error');
    return;
  }

  const project = {
    id: Date.now(),
    name: projectName,
    created: new Date().toISOString(),
    content: ''
  };

  let projects = JSON.parse(localStorage.getItem('projects') || '[]');
  projects.push(project);
  localStorage.setItem('projects', JSON.stringify(projects));
  
  closeModal();
  loadProjects();
  openProject(project.id);
}

function changeFont(fontFamily) {
  document.execCommand('fontName', false, fontFamily);
  noteArea.focus();
}

function changeFontSize(size) {
  document.execCommand('fontSize', false, size);
  noteArea.focus();
}

function insertHorizontalRule() {
  document.execCommand('insertHorizontalRule', false, null);
  noteArea.focus();
}

function showDashboard() {
  document.querySelector('.landing-container').style.display = 'none';
  document.querySelector('.home-container').style.display = 'block';
  loadProjects(); // Ensure projects are loaded when showing dashboard
}

// Enhanced keyboard shortcuts
document.addEventListener('keydown', function(e) {
  if (e.ctrlKey || e.metaKey) {
    switch(e.key.toLowerCase()) {
      case 'b':
        e.preventDefault();
        formatText('bold');
        break;
      case 'i':
        e.preventDefault();
        formatText('italic');
        break;
      case 'u':
        e.preventDefault();
        formatText('underline');
        break;
      case 'z':
        e.preventDefault();
        formatText('undo');
        break;
      case 'y':
        e.preventDefault();
        formatText('redo');
        break;
      case 'l':
        e.preventDefault();
        formatText('justifyLeft');
        break;
      case 'e':
        e.preventDefault();
        formatText('justifyCenter');
        break;
      case 'r':
        e.preventDefault();
        formatText('justifyRight');
        break;
    }
  }
});
</script>
</body></html>